<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Chrome Link Pad Option</title>
<style>
body{
}
#wrap {
	width: 600px;
	margin: 0 auto;
}
h1 {
	border-radius: 3px;
	background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(188,200,144,1)), to(rgba(157,174,91,1)));
	text-align: center;
	color: white;
	text-shadow: 1px 1px 1px #617122;
	padding: 0.5em;
	-webkit-box-shadow: 1px 1px 1px gray;
}
h2 {
	font-size: 100%;
	margin: 0 0 1em 0;
	color: #617122;
}
div.group {
	border-radius: 3px;
	border: 1px solid #A1B162;
	-webkit-box-shadow: 1px 1px 1px silver;
	padding: 1em;
	margin-bottom: 20px;
}
div.item {
	margin-left: 1em;
}
.item {
	margin-top: 1em;
}
fieldset {
	border-radius: 3px;
	border: 1px solid silver;
}
.value {
	display: inline-block;
	border-radius: 3px;
	border: 1px solid silver;
	width: 5em;
	text-align: right;
}
#ExcludeURLs {
	list-style-type: none;
	padding-left: 0;
}
input.url {
	width: 20em;
}
.tips {
	color: gray;
	display: block;
}
</style>
<script type="text/javascript">
window.addEventListener('load', function(e){
	var bg = chrome.extension.getBackgroundPage();
	Array.prototype.slice.call(document.querySelectorAll('input[type="checkbox"]')).forEach(function(elm) {
		elm.checked = bg.config[elm.id];
		elm.addEventListener('click', function(e){
			bg.config[e.target.id] = e.target.checked;
			chrome.extension.sendRequest({
				action: 'config.save'
			});
		}, false);
	});
	Array.prototype.slice.call(document.querySelectorAll('input[type="range"]')).forEach(function(elm) {
		elm.value = bg.config[elm.id];
		var output = document.getElementById(elm.id + '_val');
		output.textContent = elm.value;
		elm.addEventListener('change', function(e){
			bg.config[e.target.id] = e.target.value;
			output.textContent = e.target.value;
			chrome.extension.sendRequest({
				action: 'config.save'
			});
		}, false);
	});

	var autoSaveControl = function(){
		if (document.getElementById('AutoSave').checked) {
			document.getElementById('AutoSaveTime').disabled = false;
			document.getElementById('AutoSaveDupplicateClose').disabled = false;
		} else {
			document.getElementById('AutoSaveTime').disabled = true;
			document.getElementById('AutoSaveDupplicateClose').disabled = true;
		}
	};
	autoSaveControl();
	document.getElementById('AutoSave').addEventListener('click', function(e) {
		autoSaveControl();
	}, false);

	var AddExcludeURL = function(item, index) {
		var li = document.createElement('li');
		var input = document.createElement('input');
		input.type = 'text';
		input.className = 'url';
		input.value = item;
		input.addEventListener('input',function(e){
			bg.config.ExcludeURLs[index] = input.value;
			chrome.extension.sendRequest({
				action: 'config.save'
			});
		}, false);
		li.appendChild(input);
		var del = document.createElement('button');
		del.textContent = 'Del';
		del.addEventListener('click',function(e){
			li.parentNode.removeChild(li);
			bg.config.ExcludeURLs = bg.config.ExcludeURLs.filter(function(item, i){
				return (i != index);
			});
			chrome.extension.sendRequest({
				action: 'config.save'
			});
		}, false);
		li.appendChild(del);
		list.appendChild(li);
	};

	var list = document.getElementById('ExcludeURLs');
	var text = document.getElementById('ExcludeURL_text');
	document.getElementById('ExcludeURL_add').addEventListener('click', function(e) {
		var url = document.getElementById('ExcludeURL_text').value;
		if (url) {
			AddExcludeURL(text.value, bg.config.ExcludeURLs.length);
			bg.config.ExcludeURLs.push(url);
			chrome.extension.sendRequest({
				action: 'config.save'
			});
			text.value = '';
		}
	}, false);
	bg.config.ExcludeURLs.forEach(AddExcludeURL);

	document.getElementById('ResetLinks').addEventListener('click', function(e) {
		if (confirm('Are you sure you want to delete all of the saved links ?')) {
			chrome.extension.sendRequest({
				action: 'link.init'
			});
		}
	}, false);

	document.getElementById('ResetConfig').addEventListener('click', function(e) {
		if (confirm('Are sure you want to delete this config ?')) {
			chrome.extension.sendRequest({
				action: 'config.init'
			}, function(){
				location.reload();
			});
		}
	}, false);

	(function L10N(){
		var labels = document.querySelectorAll('label');
		for (var i = 0; i < labels.length; i++){
			var message = chrome.i18n.getMessage('option_label_' + labels[i].htmlFor);
			if (message)
				labels[i].innerHTML = message;
		}
		var buttons = document.querySelectorAll('input[type=button]');
		for (var i = 0; i < buttons.length; i++){
			var message = chrome.i18n.getMessage('option_button_' + buttons[i].id);
			if (message)
				buttons[i].value = message;
		}
		var tips = document.querySelectorAll('span.tips');
		for (var i = 0; i < tips.length; i++){
			var message = chrome.i18n.getMessage('option_' + tips[i].id);
			if (message)
				tips[i].innerHTML = message;
		}
		var titles = document.querySelectorAll('h2');
		for (var i = 0; i < titles.length; i++){
			var message = chrome.i18n.getMessage('option_title_' + titles[i].id);
			if (message)
				titles[i].innerHTML = message;
		}
		var legends = document.querySelectorAll('legend');
		for (var i = 0; i < legends.length; i++){
			var message = chrome.i18n.getMessage('option_legend_' + legends[i].id);
			if (message)
				legends[i].textContent = message;
		}
	})();
}, false);
</script>
</head>
<body>
  <div id="wrap">
    <h1>Chrome Link Pad Option</h1>
    <div id="general" class="group">
      <h2 id="TitleBasics">Basics</h2>
      <div class="item">
        <input type="checkbox" id="ToRemove"><label for="ToRemove">Remove when opened.</label>
      </div>
<!--
      <div class="item">
        <input type="checkbox" id="UseBookmark"><label for="UseBookmark">Use bookmark.</label>
        <span class="tips" iD="tips_UseBookmark">* Links are saved in the "Chrome Link Pad" folder in bookmarks, allowing you to synchronize it with other computers.</span>
      </div>
-->
    </div>
    <div id="general" class="group">
      <h2 id="TitleContextMenus">Context menus</h2>
      <fieldset class="item">
        <legend id="LinkMenu">
          Link menu
        </legend>
        <div class="item">
          <input type="checkbox" id="LinkMenuAdd"><label for="LinkMenuAdd">Save to Link Pad</label>
        </div>
      </fieldset>
      <fieldset class="item">
        <legend id="DocumentMenus">
          Document menus
        </legend>
        <div class="item">
          <input type="checkbox" id="DocumentMenuAdd"><label for="DocumentMenuAdd">Save this page to Link Pad</label>
        </div>
        <div class="item">
          <input type="checkbox" id="DocumentMenuAddClose"><label for="DocumentMenuAddClose">Save this page to Link Pad and close tab</label>
        </div>
      </fieldset>
    </div>
    <div id="autoSave" class="group">
      <h2 id="TitleAutoSave">Auto save</h2>
      <fieldset class="item">
        <legend>
          <input type="checkbox" id="AutoSave"><label for="AutoSave">The tab by which definite-period-of-time neglect is carried out is saved automatically, and is closed.</label>
        </legend>
        <div class="item">
          <label for="AutoSaveTime">Auto save time:</label>
          <input type="range" id="AutoSaveTime" max="60" min="1" step="1"> <span class="value" id="AutoSaveTime_val" /> [minute(s)]
        </div>
        <div class="item">
         <input type="checkbox" id="AutoSaveDupplicateClose"><label for="AutoSaveDupplicateClose">Close tab that is already saved.</label>
        </div>
        <fieldset class="item">
          <legend id="ExcludeURL">
            Exclude URLs (prefix)
          </legend>
          <ul id="ExcludeURLs" />
          <input type="text" id="ExcludeURL_text" class="url" value="" /><button id="ExcludeURL_add">Add</button>
        </fieldset>
      </fieldset>
    </div>
    <div id="general" class="group">
      <h2 id="TitleAdvanced">Advanced</h2>
      <div class="item">
        <input type="button" id="ResetLinks" value="Delete all links" />
        <input type="button" id="ResetConfig" value="Reset configuration" />
      </div>
    </div>
  </div>
</body>
</html>
